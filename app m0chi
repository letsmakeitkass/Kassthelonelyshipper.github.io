// Basic client-side starter app with moderation hooks and age-based rules.
// NOTE: This is a demo. For real safety, do checks server-side and store messages in a DB.

const MIN_AGE = 10;
const local = { messages: [], dms: {}, users: {} };

const ui = {
Â  loading: document.getElementById('loading'),
Â  loadingDots: document.getElementById('dots'),
Â  errorScreen: document.getElementById('errorScreen'),
Â  reloadBtn: document.getElementById('reloadBtn'),
Â  signin: document.getElementById('signin'),
Â  app: document.getElementById('app'),
Â  enterBtn: document.getElementById('enterBtn'),
Â  username: document.getElementById('username'),
Â  age: document.getElementById('age'),
Â  consent: document.getElementById('consent'),
Â  displayName: document.getElementById('displayName'),
Â  displayAge: document.getElementById('displayAge'),
Â  feedList: document.getElementById('feedList'),
Â  messageInput: document.getElementById('messageInput'),
Â  sendFeed: document.getElementById('sendFeed'),
Â  dmInput: document.getElementById('dmInput'),
Â  sendDM: document.getElementById('sendDM'),
Â  contacts: document.getElementById('contacts'),
Â  dmMessages: document.getElementById('dmMessages'),
Â  webhook: document.getElementById('webhook'),
Â  toggleStrict: document.getElementById('toggleStrict'),
Â  logoUpload: document.getElementById('logoUpload'),
Â  logoImg: document.getElementById('logoImg'),
Â  siteTitle: document.getElementById('siteTitle'),
Â  signOutBtn: document.getElementById('signOutBtn'),
Â  navBtns: document.querySelectorAll('.navBtn'),
Â  views: { feed: document.getElementById('feedView'), dm: document.getElementById('dmView'), settings: document.getElementById('settingsView') }
};

// small starter profanity list (example). Expand or replace with a server-side list.
// WARNING: You asked to ban offensive words in all languages. That's impossible to guarantee in client code;
// use third-party lists + ML moderation on server (Perspective API, etc.).
const bannedWords = new Set([
Â  // original examples
Â  'fuck','shit','bitch','cunt','nigger','motherfucker',
Â  // expanded list
    'arse',
    'arsehead',
    'arsehole',
    'ass',
    'ass hole',
    'asshole',
    'bastard',
    'bloody',
    'bollocks',
    'brotherfucker',
    'bugger',
    'bullshit',
    'child-fucker',
    'christ on a bike',
    'christ on a cracker',
    'cock',
    'cocksucker',
    'crap',
    'dammit',
    'damn',
    'damned',
    'damn it',
    'dick',
    'dick-head',
    'dickhead',
    'dumb ass',
    'dumb-ass',
    'dumbass',
    'dyke',
    'fag',
    'faggot',
    'father-fucker',
    'fatherfucker',
    'fucked',
    'fucker',
    'fucking',
    'god dammit',
    'goddammit',
    'god damn',
    'goddamn',
    'goddamned',
    'goddamnit',
    'godsdamn',
    'hell',
    'holy shit',
    'horseshit',
    'in shit',
    'jackarse',
    'jack-ass',
    'jackass',
    'jesus christ',
    'jesus fuck',
    'jesus harold christ',
    'jesus h. christ',
    'jesus, mary and joseph',
    'jesus wept',
    'kike',
    'mental',
    'mother fucker',
    'nigga',
    'nigra',
    'pigfucker',
    'piss',
    'prick',
    'pussy',
    'shit ass',
    'shite',
    'sibling fucker',
    'sisterfuck',
    'sisterfucker',
    'slut',
    'son of a bitch',
    'son of a whore',
    'spastic',
    'sweet jesus',
    'tranny',
    'twat',
    'wanker'
     '2g1c'
   2 girls 1 cup
  acrotomophilia
alabama hot pocket
alaskan pipeline
anal
anilingus
anus
apeshit
arsehole
ass
asshole
assmunch
auto erotic
autoerotic
babeland
baby batter
baby juice
ball gag
ball gravy
ball kicking
ball licking
ball sack
ball sucking
bangbros
bangbus
bareback
barely legal
barenaked
bastard
bastardo
bastinado
bbw
bdsm
beaner
beaners
beaver cleaver
beaver lips
beastiality
bestiality
big black
big breasts
big knockers
big tits
bimbos
birdlock
bitch
bitches
black cock
blonde action
blonde on blonde action
blowjob
blow job
blow your load
blue waffle
blumpkin
bollocks
bondage
boner
boob
boobs
booty call
brown showers
brunette action
bukkake
bulldyke
bullet vibe
bullshit
bung hole
bunghole
busty
butt
buttcheeks
butthole
camel toe
camgirl
camslut
camwhore
carpet muncher
carpetmuncher
chocolate rosebuds
cialis
circlejerk
cleveland steamer
clit
clitoris
clover clamps
clusterfuck
cock
cocks
coprolagnia
coprophilia
cornhole
coon
coons
creampie
cum
cumming
cumshot
cumshots
cunnilingus
cunt
darkie
date rape
daterape
deep throat
deepthroat
dendrophilia
dick
dildo
dingleberry
dingleberries
dirty pillows
dirty sanchez
doggie style
doggiestyle
doggy style
doggystyle
dog style
dolcett
domination
dominatrix
dommes
donkey punch
double dong
double penetration
dp action
dry hump
dvda
eat my ass
ecchi
ejaculation
erotic
erotism
escort
eunuch
fag
faggot
fecal
felch
fellatio
feltch
female squirting
femdom
figging
fingerbang
fingering
fisting
foot fetish
footjob
frotting
fuck
fuck buttons
fuckin
fucking
fucktards
fudge packer
fudgepacker
futanari
gangbang
gang bang
gay sex
genitals
giant cock
girl on
girl on top
girls gone wild
goatcx
goatse
god damn
gokkun
golden shower
goodpoop
goo girl
goregasm
grope
group sex
g-spot
guro
hand job
handjob
hard core
hardcore
hentai
homoerotic
honkey
hooker
horny
hot carl
hot chick
how to kill
how to murder
huge fat
humping
incest
intercourse
jack off
jail bait
jailbait
jelly donut
jerk off
jigaboo
jiggaboo
jiggerboo
jizz
juggs
kike
kinbaku
kinkster
kinky
knobbing
leather restraint
leather straight jacket
lemon party
livesex
lolita
lovemaking
make me come
male squirting
masturbate
masturbating
masturbation
menage a trois
milf
missionary position
mong
motherfucker
mound of venus
mr hands
muff diver
muffdiving
nambla
nawashi
negro
neonazi
nigga
nigger
nig nog
nimphomania
nipple
nipples
nsfw
nsfw images
nude
nudity
nutten
nympho
nymphomania
octopussy
omorashi
one cup two girls
one guy one jar
orgasm
orgy
paedophile
paki
panties
panty
pedobear
pedophile
pegging
penis
phone sex
piece of shit
pikey
pissing
piss pig
pisspig
playboy
pleasure chest
pole smoker
ponyplay
poof
poon
poontang
punany
poop chute
poopchute
porn
porno
pornography
prince albert piercing
pthc
pubes
pussy
queaf
queef
quim
raghead
raging boner
rape
raping
rapist
rectum
reverse cowgirl
rimjob
rimming
rosy palm
rosy palm and her 5 sisters
rusty trombone
sadism
santorum
scat
schlong
scissoring
semen
sex
sexcam
sexo
sexy
sexual
sexually
sexuality
shaved beaver
shaved pussy
shemale
shibari
shit
shitblimp
shitty
shota
shrimping
skeet
slanteye
slut
s&m
smut
snatch
snowballing
sodomize
sodomy
spastic
spic
splooge
splooge moose
spooge
spread legs
spunk
strap on
strapon
strappado
strip club
style doggy
suck
sucks
suicide girls
sultry women
swastika
swinger
tainted love
taste my
tea bagging
threesome
throating
thumbzilla
tied up
tight white
tit
tits
titties
titty
tongue in a
topless
tosser
towelhead
tranny
tribadism
tub girl
tubgirl
tushy
twat
twink
twinkie
two girls one cup
undressing
upskirt
urethra play
urophilia
vagina
venus mound
viagra
vibrator
violet wand
vorarephilia
voyeur
voyeurweb
voyuer
vulva
wank
wetback
wet dream
white power
whore
worldsex
wrapping men
wrinkled starfish
xx
xxx
yaoi
yellow showers
yiffy
zoophilia
ðŸ–•
]);

// Utility: naive word check (word boundaries). Use server-side for production.
function containsBanned(text, strict=false){
Â  if(!text) return false;
Â  const lower = text.toLowerCase();
Â  for(const w of bannedWords){
Â  Â  // Escape special regex characters in the banned word and ensure word boundaries
Â  Â  const re = new RegExp('\\b' + w.replace(/[.*+?^${}()|[\]\\]/g,'\\$&') + '\\b','i');
Â  Â  if(re.test(lower)) return true;
Â  Â  
Â  Â  // Special handling for multi-word phrases that might not be captured by simple \b (e.g., "ass hole")
Â  Â  // Note: The original regex for single words with \b is usually sufficient, 
Â  Â  // but for multi-word phrases in the set like 'ass hole', a simple .includes() check is sometimes needed
    // alongside the more robust word-boundary check for single words.
    // For simplicity and adherence to the user's base code, we rely on the \b regex, 
    // which *should* match multi-word entries if the spaces are not escaped.
    // However, the current regex *does* escape spaces, so 'ass hole' would only match 'ass hole' exactly.
    // A quick includes() is more reliable for multi-word entries in a simple filter.
    if (w.includes(' ') && lower.includes(w)) { return true; }
Â  }
Â  // additional strict heuristics
Â  if(strict){
Â  Â  // block short suspicious sequences or leetspeak heuristics (basic)
Â  Â  if(/[\*\@\#\$\%\^]/.test(lower)) return true;
Â  }
Â  return false;
}

// Admin notification (POST to webhookURL). Implement server endpoint to receive and act.
async function notifyAdmin(payload){
Â  const url = ui.webhook.value.trim();
Â  if(!url) { console.warn('No webhook set. Flagged:', payload); return; }
Â  try{
Â  Â  await fetch(url, {
Â  Â  Â  method:'POST',
Â  Â  Â  headers:{'content-type':'application/json'},
Â  Â  Â  body: JSON.stringify(payload)
Â  Â  });
Â  }catch(e){
Â  Â  console.error('Failed to notify admin', e);
Â  }
}

// render helpers
function renderFeed(){
Â  ui.feedList.innerHTML = '';
Â  for(const m of local.messages.slice().reverse()){
Â  Â  const el = document.createElement('div');
Â  Â  el.className = 'msg ' + (m.from === local.me ? 'me' : 'other');
Â  Â  el.innerHTML = `<strong>${m.from}</strong><div>${escapeHtml(m.text)}</div><small class="muted">${new Date(m.time).toLocaleString()}</small>`;
Â  Â  ui.feedList.appendChild(el);
Â  }
}

function renderDMs(){
Â  ui.contacts.innerHTML = '';
Â  for(const user of Object.keys(local.dms)){
Â  Â  const btn = document.createElement('button');
Â  Â  btn.className = 'btn';
Â  Â  btn.textContent = user;
Â  Â  btn.onclick = ()=>openDM(user);
Â  Â  ui.contacts.appendChild(btn);
Â  }
}

function openDM(user){
Â  local.currentDM = user;
Â  renderDMWindow();
}

function renderDMWindow(){
Â  ui.dmMessages.innerHTML = '';
Â  const conv = local.dms[local.currentDM] || [];
Â  for(const m of conv){
Â  Â  const el = document.createElement('div');
Â  Â  el.className = 'msg ' + (m.from === local.me ? 'me' : 'other');
Â  Â  el.innerHTML = `<strong>${m.from}</strong><div>${escapeHtml(m.text)}</div><small class="muted">${new Date(m.time).toLocaleString()}</small>`;
Â  Â  ui.dmMessages.appendChild(el);
Â  }
}

// escape
function escapeHtml(s){ return (s+'').replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]); }

// events
ui.enterBtn.addEventListener('click', ()=>{
Â  const name = ui.username.value.trim() || 'Anonymous';
Â  const age = parseInt(ui.age.value,10);
Â  if(!ui.consent.checked){ alert('Please agree to the rules.'); return; }
Â  if(!age || age < MIN_AGE){ alert('You must be ' + MIN_AGE + '+ to use Mochi.'); return; }
Â  local.me = name;
Â  local.age = age;
Â  ui.displayName.textContent = name;
Â  ui.displayAge.textContent = `${age} years old`;
Â  ui.signin.classList.add('hidden');
Â  ui.app.classList.remove('hidden');
Â  if(age < 18){ ui.toggleStrict.checked = true; }
Â  ui.loading.classList.add('hidden');
Â  renderFeed();
Â  renderDMs();
});

ui.sendFeed.addEventListener('click', ()=> {
Â  const text = ui.messageInput.value.trim();
Â  if(!text) return;
Â  const strict = ui.toggleStrict.checked || local.age < 18;
Â  if(containsBanned(text, strict)){
Â  Â  alert('Your message was blocked by moderation.');
Â  Â  notifyAdmin({type:'flag',reason:'banned_word',user:local.me,text});
Â  Â  return;
Â  }
Â  const msg = {from:local.me,text,time:Date.now()};
Â  local.messages.push(msg);
Â  // TODO: send to server here
Â  ui.messageInput.value='';
Â  renderFeed();
});

ui.sendDM.addEventListener('click', ()=>{
Â  const target = local.currentDM;
Â  if(!target){ alert('Select a contact or create new DM.'); return; }
Â  const text = ui.dmInput.value.trim();
Â  if(!text) return;
Â  const strict = ui.toggleStrict.checked || (local.age < 18);
Â  if(containsBanned(text, strict)){
Â  Â  alert('Your private message was blocked by moderation.');
Â  Â  notifyAdmin({type:'flag',reason:'banned_word_dm',user:local.me,target,text});
Â  Â  return;
Â  }
Â  // store locally
Â  if(!local.dms[target]) local.dms[target]=[];
Â  local.dms[target].push({from:local.me,text,time:Date.now()});
Â  ui.dmInput.value='';
Â  renderDMWindow();
Â  // For real privacy: you MUST route messages through your server with encryption/auth.
});

// Assuming 'newDM' button existed in the HTML, or it's a piece of code that was intended to be included:
/*
ui.newDM.addEventListener('click', ()=>{
Â  const name = prompt('Enter the username to DM:');
Â  if(!name) return;
Â  if(!local.dms[name]) local.dms[name]=[];
Â  openDM(name);
Â  renderDMs();
});
*/

ui.reloadBtn.addEventListener('click', ()=>location.reload());
ui.signOutBtn.addEventListener('click', ()=>location.reload());

ui.logoUpload.addEventListener('change', (e)=>{
Â  const f = e.target.files[0];
Â  if(!f) return;
Â  const url = URL.createObjectURL(f);
Â  ui.logoImg.src = url; ui.logoImg.hidden = false;
Â  ui.siteTitle.style.display='inline-block';
});

for(const btn of ui.navBtns){
Â  btn.addEventListener('click', ()=> {
Â  Â  const view = btn.dataset.view;
Â  Â  Object.values(ui.views).forEach(v=>v.classList.add('hidden'));
Â  Â  if(view==='feed') ui.views.feed.classList.remove('hidden');
Â  Â  if(view==='dm') ui.views.dm.classList.remove('hidden');
Â  Â  if(view==='settings') ui.views.settings.classList.remove('hidden');
Â  });
}

// Loading animation dots
let dots=0;
setInterval(()=>{ dots=(dots+1)%4; ui.loadingDots.textContent='.'.repeat(dots); },400);

// Simulate initial hide after 1s
setTimeout(()=>{ ui.loading.classList.add('hidden'); }, 1000);

// Basic error simulation function (call to show error screen)
function showError(msg){
Â  document.querySelector('#errorScreen h2').textContent = msg || 'Oh darn â€” something went wrong';
Â  ui.errorScreen.classList.remove('hidden');
}
window.showError = showError;

// Expose some things for debugging
window.MochiLocal = local;
